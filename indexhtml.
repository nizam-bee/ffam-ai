const fs = require('fs');
const path = require('path');
const archiver = require('archiver');

export default async function handler(req, res) {
  if (req.method !== 'POST') return res.status(405).end();

  const { title, desc } = req.body;
  const time = Date.now();
  const folder = path.join('/tmp', `ffam_${time}`);
  fs.mkdirSync(folder, { recursive: true });

  const html = `<html><head><title>${title}</title></head><body><h1>${title}</h1><p>${desc}</p></body></html>`;
  fs.writeFileSync(path.join(folder, 'index.html'), html);

  const zipPath = `/tmp/ffam_${time}.zip`;
  const output = fs.createWriteStream(zipPath);
  const archive = archiver('zip', { zlib: { level: 9 } });

  archive.pipe(output);
  archive.directory(folder, false);
  await archive.finalize();

  output.on('close', () => {
    res.status(200).json({ zipUrl: `https://vercel-temp-link.com/ffam_${time}.zip` }); // Update if hosting downloads
  });
}
